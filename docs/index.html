<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>수산물 건강 챗봇 · 시범</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{--bg:#0f141a;--panel:#121a22;--text:#e6edf3;--muted:#9fb0bf;--accent:#2f81f7;--chip:#1b2733;--chipText:#d7e2ea;--ring:#4f91ff;--border:#223041}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:1280px;margin:24px auto;padding:0 16px}
    .grid{display:grid;gap:16px;grid-template-columns:1fr 1fr 1fr}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:16px;min-height:420px}
    h2{margin:0 0 12px;font-size:24px}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--chip);color:var(--chipText);border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-size:14px;cursor:pointer;user-select:none;outline:0}
    .chip:focus{box-shadow:0 0 0 3px var(--ring)}
    .chip.active{background:var(--accent);color:#fff;border-color:transparent}
    .muted{color:var(--muted)}
    .content{white-space:pre-wrap;line-height:1.6}
    .btn{background:#1b2a3a;color:#d7e2ea;border:1px solid var(--border);border-radius:10px;padding:10px 14px;font-size:14px;cursor:pointer}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    @media (max-width:1024px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="panel">
        <h2>카테고리</h2>
        <div id="categoryList" class="chips" aria-label="카테고리 목록"></div>
      </div>

      <div class="panel">
        <h2>어종</h2>
        <div id="fishList" class="chips" aria-label="어종 목록"></div>
      </div>

      <div class="panel">
        <h2>세부 내용</h2>
        <div class="toolbar">
          <button id="btnAll" class="btn">전체 보기</button>
          <button id="btnSource" class="btn">출처</button>
        </div>
        <div id="content" class="content" style="margin-top:10px;">섹션을 선택하세요.</div>
        <p class="muted" style="margin-top:16px">카테고리를 선택하면 오른쪽에 어종이 나타납니다. 어종을 선택하면 ‘출처 / 주요영양소 / 약효 및 효용 / 제철 및 선택법 / 조리 포인트 / 어울리는 요리 / 레시피’를 고를 수 있습니다.</p>
        <p class="muted">데이터는 <code>health_fish.json</code>에서 로드됩니다.</p>
      </div>
    </div>
  </div>

  <!-- 폴백 데이터 (fetch 실패시 자동 사용) -->
  <script id="healthDataInline" type="application/json">
  {
    "categories": {
      "고혈압 예방": ["김","다시마","멸치","가리비","미역","톳","우뭇가사리","매생이"],
      "간 기능 향상": ["문어","낙지","대하","꽃게","주꾸미","소라","꼬막","재첩","바지락","대합"]
    }
  }
  </script>

  <script>
  (function(){
    const $ = (s)=>document.querySelector(s);
    const categoryList = $('#categoryList');
    const fishList = $('#fishList');
    const content = $('#content');
    const btnAll = $('#btnAll');
    const btnSource = $('#btnSource');

    let DATA=null, currentCategory=null, currentFish=null;

    function renderCategories(){
      categoryList.innerHTML='';
      Object.keys(DATA.categories).forEach(cat=>{
        const chip=document.createElement('button');
        chip.className='chip';
        chip.textContent=cat;
        chip.onclick=()=>{
          currentCategory=cat; currentFish=null;
          [...categoryList.children].forEach(c=>c.classList.remove('active'));
          chip.classList.add('active');
          renderFish();
          content.textContent=`[${cat}] 어종을 선택하세요.`;
        };
        categoryList.appendChild(chip);
      });
    }

    function renderFish(){
      fishList.innerHTML='';
      (DATA.categories[currentCategory]||[]).forEach(f=>{
        const chip=document.createElement('button');
        chip.className='chip';
        chip.textContent=f;
        chip.onclick=()=>{
          currentFish=f;
          [...fishList.children].forEach(c=>c.classList.remove('active'));
          chip.classList.add('active');
          renderDetails('source');
        };
        fishList.appendChild(chip);
      });
    }

    function renderDetails(mode){
      if(!currentCategory||!currentFish){content.textContent='세션을 선택하세요.';return;}
      const d=(DATA.details&&DATA.details[currentFish])||{};
      const blocks=[
        ['출처', d['출처']],
        ['주요영양소', d['주요영양소']],
        ['약효 및 효용', d['약효 및 효용']],
        ['제철 및 선택법', d['제철 및 선택법']],
        ['조리 포인트', d['조리 포인트']],
        ['어울리는 요리', d['어울리는 요리']],
        ['레시피', d['레시피']]
      ];
      if(mode==='all'){
        const lines=[];
        lines.push(`카테고리를 선택하세요.\n[${currentCategory}] 어종을 선택하세요.\n`);
        lines.push(`[${currentCategory} · ${currentFish}]`);
        lines.push('・ 세션을 선택하세요.\n');
        lines.push('📰 전체 보기');
        blocks.forEach(([k,v])=>{lines.push(`- ${k}`);lines.push(v?String(v):'정보 없음');});
        content.textContent=lines.join('\n');
      }else{
        const val=d['출처']?String(d['출처']):'정보 없음';
        content.textContent=`카테고리를 선택하세요.\n[${currentCategory}] 어종을 선택하세요.\n\n[${currentCategory} · ${currentFish}]\n・ 세션을 선택하세요.\n\n🪪 출처\n${val}`;
      }
    }

    btnAll.onclick=()=> currentFish ? renderDetails('all') : content.textContent='· 전체 보기는 어종 선택 후 이용할 수 있습니다. 어종을 먼저 선택해 주세요.';
    btnSource.onclick=()=> currentFish ? renderDetails('source') : content.textContent='· 출처는 어종 선택 후 이용할 수 있습니다. 어종을 먼저 선택해 주세요.';

    async function loadData(){
      // 1) 외부 JSON 시도 (캐시 무효화)
      try{
        const res=await fetch(`health_fish.json?ts=${Date.now()}`,{cache:'no-store'});
        if(!res.ok) throw new Error(res.status);
        const json=await res.json();
        if(!json||!json.categories) throw new Error('invalid schema');
        console.log('[health-fish] loaded from health_fish.json');
        return json;
      }catch(e){
        console.warn('[health-fish] fetch failed, use inline fallback', e);
      }
      // 2) 인라인 폴백
      try{
        const inline=$('#healthDataInline');
        if(inline && inline.textContent.trim()){
          const json=JSON.parse(inline.textContent);
          if(json && json.categories){
            console.log('[health-fish] loaded from inline fallback');
            return json;
          }
        }
      }catch(e){console.error(e);}
      return null;
    }

    window.addEventListener('DOMContentLoaded', async()=>{
      DATA=await loadData();
      if(!DATA){
        content.innerHTML='데이터 로드 실패. <br>docs/health_fish.json 존재/철자/경로 확인';
        return;
      }
      DATA.details = DATA.details || {}; // details 없을 수도 있어 안전 가드
      renderCategories();
      content.textContent='카테고리를 먼저 선택하세요.';
    });
  })();
  </script>
</body>
</html>
